@page "/raport"
@using System.Net
@using System.Net.Http.Json
@using MudBlazor


<MudGrid Class="pa-4">
    <!-- Заголовок -->
    <MudItem xs="12" Class="text-center">
        <MudText Typo="Typo.h4" Align="Align.Center" Class="mt-4">
            Miesięczny raport zmiany wagi
        </MudText>
    </MudItem>

    <!-- Таблица данных -->
    <MudItem xs="12" Class="mt-4">
        @if (Weights != null)
        {
            <MudTable Items="Weights" Elevation="2">
                <HeaderContent>
                    <MudTh>Data pomiaru</MudTh>
                    <MudTh>Waga</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd>@context.Date.ToShortDateString()</MudTd>
                    <MudTd>@context.Weight kg</MudTd>
                </RowTemplate>
            </MudTable>
        }
        else
        {
            <MudProgressCircular Indeterminate="true" Class="m-auto" />
        }
    </MudItem>
</MudGrid>

@code {
    [Parameter] public int UserId { get; set; }

    private List<UserWeight> Weights;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Pobieranie danych z API
            var response = await Http.GetFromJsonAsync<WeightResponse>($"api/Report/Weight/{UserId}");

            if (response?.Data != null)
            {
                // Przekształcanie danych
                Weights = response.Data.Select(w => new UserWeight
                {
                    Date = DateTime.Parse(w.Data),
                    Weight = w.Waga
                }).ToList();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Błąd podczas ładowania danych: {ex.Message}");
        }
    }

    private class WeightResponse
    {
        public List<ApiWeight> Data { get; set; }
        public bool Success { get; set; }
        public string Message { get; set; }
    }

    private class ApiWeight
    {
        public string Data { get; set; }
        public double Waga { get; set; }
    }

    private class UserWeight
    {
        public DateTime Date { get; set; }
        public double Weight { get; set; }
    }
}
